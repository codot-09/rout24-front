<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Profilim</title>
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        body,html{height:100%;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f8fafc;color:#0f172a;overflow-x:hidden}
        .header{position:fixed;top:0;left:0;right:0;height:74px;background:#800000;color:#fff;display:flex;align-items:center;padding:0 20px;box-shadow:0 8px 30px rgba(128,0,0,.18);z-index:1000}
        .back-btn{background:none;border:none;width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s}
        .back-btn:active{transform:scale(.92);background:rgba(255,255,255,.12)}
        .back-btn svg{width:28px;height:28px;fill:#fff}
        .header h1{font:900 23px/1 system-ui;margin-left:10px}
        .main{padding:90px 20px 40px}
        .profile-card{background:#fff;border-radius:28px;padding:28px 24px;margin-bottom:32px;box-shadow:0 15px 45px rgba(0,0,0,.1);display:flex;align-items:center;gap:20px;cursor:pointer;transition:transform .3s}
        .profile-card:active{transform:scale(.98)}
        .avatar{width:76px;height:76px;border:4px solid #fff;border-radius:50%;object-fit:cover;box-shadow:0 8px 25px rgba(128,0,0,.25)}
        .user-info{flex:1}
        .user-name{font:800 22px/1 system-ui;margin-bottom:4px}
        .user-role{font:600 16px/1 system-ui;color:#64748b}
        .menu{margin-top:8px}
        .menu-item{display:flex;align-items:center;padding:20px 0;border-bottom:1px solid #e2e8f0;transition:all .3s;cursor:pointer}
        .menu-item:last-child{border-bottom:none}
        .menu-item:active{background:#fdfdfd;padding-left:8px;padding-right:8px;border-radius:16px}
        .menu-icon{width:26px;height:26px;fill:#800000;margin-right:18px;flex-shrink:0}
        .menu-title{font:600 17px/1 system-ui;flex:1}
        .menu-arrow{width:20px;height:20px;fill:#94a3b8;transition:transform .3s}
        .menu-item:active .menu-arrow{transform:translateX(6px)}
        .logout-item{color:#c62828}
        .logout-item .menu-icon{fill:#c62828}
        .loader{text-align:center;padding:120px 20px;color:#94a3b8;font:18px system-ui}
    </style>
</head>
<body>

<header class="header">
    <button class="back-btn" onclick="history.back()">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <h1>Profilim</h1>
</header>

<main class="main">
    <div id="content" class="loader">Yuklanmoqda...</div>
</main>

<script>
const token=localStorage.getItem('token');
if(!token)location.href='login.html';

(async()=>{
    try{
        const r=await fetch('https://api.rout24.online/users/profile',{
            headers:{Authorization:`Bearer ${token}`}
        });
        const {success,data}=await r.json();
        if(!success||!data)throw new Error();

        const name=data.fullName||'Foydalanuvchi';
        const role=data.role==='DRIVER'?'Haydovchi':data.role==='CLIENT'?'Mijoz':'Foydalanuvchi';
        const img=data.imageUrl||`https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=800000&color=fff&size=76&bold=true`;

        document.getElementById('content').innerHTML=`
            <div class="profile-card" onclick="location.href='edit-profile.html'">
                <img src="${img}" alt="Avatar" class="avatar">
                <div class="user-info">
                    <div class="user-name">${name}</div>
                    <div class="user-role">${role}</div>
                </div>
                <svg class="menu-arrow" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
            </div>

            <div class="menu">
                <div class="menu-item" onclick="location.href='security.html'">
                    <svg class="menu-icon" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 18.2c-4.51-.77-8-4.43-8-8.7V6.3l7-3.11v11.75l-2.45-2.45-.71.71L12 18.78l4.16-4.16-.71-.71L12 15.54V4.76l7 3.11V10.5c0 4.27-3.49 7.93-8 8.7z"/></svg>
                    <div class="menu-title">Xavfsizlik va shartlar</div>
                    <svg class="menu-arrow" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                </div>

                <div class="menu-item" onclick="location.href='support.html'">
                    <svg class="menu-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 14 13 15h-2v-.5c0-1.12.55-2.17 1.44-2.88l.76-.75C13.43 10.3 14 9.49 14 8.5c0-1.38-1.12-2.5-2.5-2.5S9 7.12 9 8.5H7c0-2.48 2.02-4.5 4.5-4.5s4.5 2.02 4.5 4.5c0 1.4-1.2 2.6-2.43 3.25z"/></svg>
                    <div class="menu-title">Qo'llab-quvvatlash</div>
                    <svg class="menu-arrow" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                </div>

                <div class="menu-item logout-item" onclick="if(confirm('Hisobdan chiqish?')){localStorage.removeItem('token');location.href='login.html'}">
                    <svg class="menu-icon" viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
                    <div class="menu-title">Hisobdan chiqish</div>
                    <svg class="menu-arrow" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                </div>
            </div>
        `;
    }catch{
        document.getElementById('content').innerHTML='<div style="text-align:center;padding:100px 20px;color:#c62828;font:18px system-ui">Profil yuklanmadi</div>';
    }
})();
</script>
</body>
</html>