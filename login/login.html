<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kirish</title>

<style>
:root{
--primary:#800000;
--primary-light:#a00000;
--shadow:rgba(128,0,0,.25);
--radius:28px
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{
height:100%;
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
background:#fff
}
.page{
height:100%;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
gap:26px;
padding:24px;
text-align:center
}
.logo{
width:150px;
height:150px
}
.logo img{
width:100%;
height:100%;
object-fit:contain;
filter:drop-shadow(0 6px 14px rgba(128,0,0,.18))
}
h1{
font-size:36px;
font-weight:900;
color:var(--primary);
letter-spacing:-1px
}
.desc{
font-size:18px;
color:rgba(0,0,0,.75);
max-width:320px
}
.terms{
display:flex;
align-items:center;
gap:12px;
font-size:15px;
color:rgba(0,0,0,.75)
}
.terms input{
width:22px;
height:22px;
accent-color:var(--primary)
}
.terms a{
color:var(--primary);
font-weight:600;
text-decoration:none;
border-bottom:1px solid rgba(128,0,0,.3)
}
.telegram-section{
margin-top:12px;
position:relative
}
.telegram-section iframe{
width:280px!important;
height:72px!important;
border-radius:var(--radius)!important;
box-shadow:0 18px 36px var(--shadow)!important
}
.lock{
position:absolute;
inset:0;
border-radius:var(--radius);
background:rgba(255,255,255,.75);
backdrop-filter:blur(4px);
display:flex;
align-items:center;
justify-content:center;
font-size:14px;
font-weight:700;
color:#555;
pointer-events:auto;
transition:.3s
}
.lock.hidden{
opacity:0;
pointer-events:none
}
</style>
</head>
<body>

<div class="page">

<div class="logo">
<img src="/assets/icon.png">
</div>

<h1>Xush kelibsiz</h1>
<div class="desc">Telegram orqali bir bosishda tez va xavfsiz kiring</div>

<div class="terms">
<input type="checkbox" id="terms">
<label for="terms">
Men <a href="oferta.html" target="_blank">oferta shartlari</a> bilan tanishdim
</label>
</div>

<div class="telegram-section">
<script async src="https://telegram.org/js/telegram-widget.js?22"
data-telegram-login="rout24bot"
data-size="large"
data-userpic="false"
data-radius="28"
data-onauth="onTelegramAuth(user)"
data-request-access="write"></script>

<div class="lock" id="lock">Avval oferta shartlarini tasdiqlang</div>
</div>

</div>

<script>
const terms=document.getElementById('terms')
const lock=document.getElementById('lock')

terms.addEventListener('change',()=>{
lock.classList.toggle('hidden',terms.checked)
})

function onTelegramAuth(user){
if(!terms.checked)return
fetch('https://api.rout24.online/auth/login',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
chatId:String(user.id),
username:user.username||'',
imageUrl:user.photo_url||''
})
})
.then(r=>r.json())
.then(d=>{
if(d.success&&d.data?.token){
localStorage.setItem('token',d.data.token)
localStorage.setItem('role',d.data.role||'')
location.href=d.data.role==='DRIVER'?'/driver/dashboard':d.data.role==='CLIENT'?'/client/dashboard':'/'
}else alert(d.message||'Xatolik')
})
.catch(()=>alert('Aloqa xatosi'))
}
window.onTelegramAuth=onTelegramAuth
</script>

</body>
</html>
