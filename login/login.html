<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kirish</title>
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        body,html{height:100%;background:#fff;color:#800000;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;overflow:hidden}
        .container{
            height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;
            padding:0 40px;text-align:center;
        }
        h2{
            font-size:38px;font-weight:900;letter-spacing:-1.2px;margin-bottom:20px;
        }
        p{
            font-size:19px;line-height:1.6;opacity:0.9;max-width:340px;margin-bottom:90px;
        }
        /* Telegram widgetni to'liq o'zimiz boshqaramiz */
        .telegram-login-wrapper{
            width:100%;max-width:380px;
        }
        iframe[name="telegram-login-rout24bot"]{
            width:100% !important;
            height:68px !important;          /* Istagan balandlik */
            border-radius:32px !important;   /* Tugma kabi yumaloq */
            border:none !important;
            box-shadow:0 22px 44px rgba(128,0,0,0.3) !important;
            transform:scale(1);
            transition:transform .35s cubic-bezier(.2,.8,.2,1),box-shadow .35s;
        }
        iframe[name="telegram-login-rout24bot"]:active{
            transform:scale(.945) !important;
            box-shadow:0 12px 28px rgba(128,0,0,0.34) !important;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Kirish</h2>
    <p>Telegram orqali bir marta bosish bilan tezkor kirish</p>

    <div class="telegram-login-wrapper">
        <script async src="https://telegram.org/js/telegram-widget.js?22"
                data-telegram-login="rout24bot"
                data-size="large"
                data-userpic="false"
                data-radius="32"
                data-onauth="onTelegramAuth(user)"
                data-request-access="write"></script>
    </div>
</div>

<script>
function onTelegramAuth(user) {
    fetch('https://api.rout24.online/auth/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            chatId: String(user.id),
            username: user.username || "",
            imageUrl: user.photo_url || ""
        })
    })
    .then(r => r.json())
    .then(res => {
        if (res.success && res.data?.token) {
            localStorage.setItem('token', res.data.token);
            const role = res.data.role;
            if (!role) location.href = 'set-credentials.html';
            else if (role === 'DRIVER') location.href = 'driver-dashboard.html';
            else if (role === 'CLIENT') location.href = 'client-dashboard.html';
        } else alert('Kirishda xatolik');
    })
    .catch(() => alert('Internet aloqasini tekshiring'));
}
</script>

</body>
</html>