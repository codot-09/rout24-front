<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kirish</title>

<style>
:root{
--primary:#800000;
--primary-light:#a00000;
--radius:28px
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{
height:100%;
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
background:#fff
}
.page{
height:100%;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
gap:32px;
padding:24px;
text-align:center
}
.logo{
width:150px;
height:150px
}
.logo img{
width:100%;
height:100%;
object-fit:contain
}
h2{
font-size:36px;
font-weight:900;
color:var(--primary)
}
p{
font-size:18px;
max-width:320px;
color:rgba(0,0,0,.75)
}
.terms{
display:flex;
gap:12px;
align-items:center;
font-size:15px;
color:rgba(0,0,0,.75)
}
.terms input{
width:22px;
height:22px;
accent-color:var(--primary)
}
.terms a{
color:var(--primary);
font-weight:600;
text-decoration:none
}
.telegram-box{
position:relative;
margin-top:12px
}
.telegram-box iframe{
width:280px!important;
height:72px!important;
border-radius:var(--radius)!important;
box-shadow:0 18px 36px rgba(128,0,0,.28)!important
}
.overlay{
position:absolute;
inset:0;
background:rgba(255,255,255,.85);
backdrop-filter:blur(4px);
border-radius:var(--radius);
display:flex;
align-items:center;
justify-content:center;
font-weight:700;
color:#555;
pointer-events:auto;
transition:.3s
}
.overlay.hidden{
opacity:0;
pointer-events:none
}
</style>
</head>
<body>

<div class="page">
<div class="logo">
<img src="/assets/icon.png">
</div>

<h2>Xush kelibsiz!</h2>
<p>Telegram orqali tez va xavfsiz kiring</p>

<div class="terms">
<input type="checkbox" id="terms">
<label for="terms">Men <a href="oferta.html" target="_blank">oferta shartlari</a> bilan tanishdim</label>
</div>

<div class="telegram-box">
<script async src="https://telegram.org/js/telegram-widget.js?22"
data-telegram-login="rout24bot"
data-size="large"
data-userpic="false"
data-radius="28"
data-onauth="onTelegramAuth(user)"
data-request-access="write"></script>

<div class="overlay" id="overlay">Avval oferta shartlarini tasdiqlang</div>
</div>
</div>

<script>
const terms=document.getElementById('terms')
const overlay=document.getElementById('overlay')

terms.addEventListener('change',()=>{
overlay.classList.toggle('hidden',terms.checked)
})

function onTelegramAuth(user){
if(!terms.checked)return
fetch('https://api.rout24.online/auth/login',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
chatId:String(user.id),
username:user.username||'',
imageUrl:user.photo_url||''
})
})
.then(r=>r.json())
.then(d=>{
if(d.success&&d.data?.token){
localStorage.setItem('token',d.data.token)
localStorage.setItem('role',d.data.role||'')
location.href=d.data.role==='DRIVER'?'/driver/dashboard':d.data.role==='CLIENT'?'/client/dashboard':'/'
}else alert(d.message||'Xatolik')
})
.catch(()=>alert('Aloqa xatosi'))
}
window.onTelegramAuth=onTelegramAuth
</script>

</body>
</html>
