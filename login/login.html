<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kirish</title>

<style>
:root{
--primary:#800000;
--primary-light:#a00000;
--shadow:rgba(128,0,0,.25);
--radius-lg:32px;
--radius-md:28px;
--transition:all .35s cubic-bezier(.2,.8,.2,1)
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{
height:100%;
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
background:#fff;
color:#800000
}
.container{
height:100%;
display:flex;
flex-direction:column;
justify-content:space-between;
padding:40px 24px 160px;
text-align:center
}
.header{
flex:1;
display:flex;
flex-direction:column;
justify-content:center;
gap:28px
}
.illustration{
width:170px;
height:170px;
margin:0 auto
}
.illustration img{
width:100%;
height:100%;
object-fit:contain;
filter:drop-shadow(0 6px 14px rgba(128,0,0,.18))
}
h2{
font-size:38px;
font-weight:900;
letter-spacing:-1.2px
}
p{
font-size:18px;
line-height:1.6;
color:rgba(0,0,0,.75);
max-width:340px;
margin:0 auto
}
.terms{
display:flex;
gap:12px;
align-items:center;
justify-content:center;
font-size:15px;
color:rgba(0,0,0,.75);
margin-bottom:24px
}
.terms input{
width:22px;
height:22px;
accent-color:var(--primary)
}
.terms a{
color:var(--primary);
font-weight:600;
text-decoration:none;
border-bottom:1px solid rgba(128,0,0,.3)
}
.login-box{
background:linear-gradient(180deg,#fff,#f7f7f7);
border-radius:var(--radius-lg);
padding:28px 20px;
box-shadow:0 22px 44px var(--shadow);
max-width:400px;
margin:0 auto
}
.telegram-login-wrapper{
opacity:0;
pointer-events:none;
transition:var(--transition)
}
.telegram-login-wrapper.active{
opacity:1;
pointer-events:auto
}
.telegram-login-wrapper iframe{
width:100%!important;
height:72px!important;
border-radius:var(--radius-md)!important;
box-shadow:0 18px 36px rgba(128,0,0,.28)!important
}
.btn{
width:100%;
height:72px;
border-radius:var(--radius-md);
border:none;
font-size:18px;
font-weight:700;
color:#fff;
background:linear-gradient(135deg,#c0c0c0,#9a9a9a);
cursor:not-allowed;
display:flex;
align-items:center;
justify-content:center;
gap:10px;
transition:var(--transition);
box-shadow:0 14px 28px rgba(0,0,0,.2)
}
.btn.active{
cursor:pointer;
background:linear-gradient(135deg,var(--primary),var(--primary-light));
box-shadow:0 18px 36px var(--shadow)
}
.btn.active:active{
transform:scale(.96)
}
.btn.loading{
pointer-events:none
}
.btn.loading::after{
content:'';
width:22px;
height:22px;
border:3px solid rgba(255,255,255,.4);
border-top-color:#fff;
border-radius:50%;
animation:spin .8s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div class="container">
<div class="header">
<div class="illustration">
<img src="/assets/icon.png">
</div>
<h2>Xush kelibsiz!</h2>
<p>Telegram orqali bir marta bosish bilan tez va xavfsiz kiring</p>
</div>

<div>
<div class="terms">
<input type="checkbox" id="terms">
<label for="terms">Men <a href="oferta.html" target="_blank">oferta shartlari</a> bilan tanishdim</label>
</div>

<div class="login-box">
<div class="telegram-login-wrapper" id="telegram-wrapper">
<script async src="https://telegram.org/js/telegram-widget.js?22"
data-telegram-login="rout24bot"
data-size="large"
data-userpic="false"
data-radius="28"
data-onauth="onTelegramAuth(user)"
data-request-access="write"></script>
</div>

<button class="btn" id="loginBtn" disabled>Oferta shartlarini tasdiqlang</button>
</div>
</div>
</div>

<script>
const terms=document.getElementById('terms')
const tg=document.getElementById('telegram-wrapper')
const btn=document.getElementById('loginBtn')

function toggle(){
if(terms.checked){
tg.classList.add('active')
btn.style.display='none'
}else{
tg.classList.remove('active')
btn.style.display='flex'
btn.textContent='Oferta shartlarini tasdiqlang'
btn.disabled=true
}
}
terms.addEventListener('change',toggle)
window.addEventListener('load',toggle)

function onTelegramAuth(user){
if(!terms.checked)return
btn.style.display='flex'
tg.style.display='none'
btn.classList.add('loading')
btn.textContent=''

fetch('https://api.rout24.online/auth/login',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
chatId:String(user.id),
username:user.username||'',
imageUrl:user.photo_url||''
})
})
.then(r=>r.json())
.then(d=>{
btn.classList.remove('loading')
if(d.success&&d.data?.token){
localStorage.setItem('token',d.data.token)
localStorage.setItem('role',d.data.role||'')
location.href=d.data.role==='DRIVER'?'/driver/dashboard':d.data.role==='CLIENT'?'/client/dashboard':'/'
}else{
btn.textContent='Qayta urinish'
btn.classList.add('active')
btn.disabled=false
}
})
.catch(()=>{
btn.classList.remove('loading')
btn.textContent='Aloqa xatosi'
btn.classList.add('active')
btn.disabled=false
})
}
window.onTelegramAuth=onTelegramAuth
</script>

</body>
</html>
