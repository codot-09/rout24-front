<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ma'lumotlarni to'ldirish</title>
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        body,html{height:100%;background:#fff;color:#800000;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;overflow:hidden}
        .container{
            height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;
            padding:0 40px;text-align:center;
        }
        .illustration{
            width:260px;height:260px;margin-bottom:60px;
        }
        .illustration svg{width:100%;height:100%}
        h2{
            font-size:38px;font-weight:900;letter-spacing:-1.2px;margin-bottom:20px;
        }
        p{
            font-size:19px;line-height:1.6;opacity:0.9;max-width:340px;margin-bottom:50px;
        }
        .form{
            width:100%;max-width:380px;
        }
        input,select{
            width:100%;padding:20px 18px;margin-bottom:20px;
            border:2px solid rgba(128,0,0,0.15);border-radius:24px;
            font-size:18px;background:#fff;transition:border .3s;
        }
        input:focus,select:focus{
            outline:none;border-color:#800000;
        }
        select{
            appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23800000' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat:no-repeat;background-position:right 18px center;
        }
        .btn{
            width:100%;background:#800000;color:#fff;border:none;
            padding:23px 0;border-radius:32px;font-size:20px;font-weight:800;
            letter-spacing:0.4px;box-shadow:0 22px 44px rgba(128,0,0,0.3);
            transition:transform .35s cubic-bezier(.2,.8,.2,1),box-shadow .35s;
        }
        .btn:active{
            transform:scale(.945);box-shadow:0 12px 28px rgba(128,0,0,0.34);
        }
    </style>
</head>
<body>

<div class="container">
    <div class="illustration">
        <svg viewBox="0 0 120 120">
            <path d="M60 15 L105 40 L105 80 L60 105 L15 80 L15 40 Z" fill="none" stroke="#800000" stroke-width="3.2"/>
            <circle cx="60" cy="60" r="28" fill="#800000" opacity="0.12"/>
            <path d="M40 58 L55 73 L80 48" stroke="#800000" stroke-width="6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>

    <h2>Ma'lumotlarni to‘ldiring</h2>
    <p>Bu bir marta kerak bo‘ladi. Keyin tez kirishingiz mumkin</p>

    <div class="form">
        <input type="text" id="fullName" placeholder="To'liq ismingiz" required>
        
        <select id="role" required>
            <option value="" disabled selected>Rolingizni tanlang</option>
            <option value="DRIVER">Haydovchi</option>
            <option value="CLIENT">Mijoz</option>
        </select>

        <button class="btn" onclick="submitCredentials()">Davom etish</button>
    </div>
</div>

<script>
async function submitCredentials() {
    const fullName = document.getElementById('fullName').value.trim();
    const role = document.getElementById('role').value;
    const token = localStorage.getItem('token');

    if (!fullName || !role) {
        alert('Iltimos, barcha maydonlarni to‘ldiring');
        return;
    }

    const btn = document.querySelector('.btn');
    btn.textContent = 'Yuborilmoqda...';
    btn.disabled = true;

    try {
        const res = await fetch('https://api.rout24.online/users/credentials', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                fullName: fullName,
                role: role,
                imageUrl: ""
            })
        });

        if (res.ok) {
            if (role === 'DRIVER') {
                location.href = '/driver/dashboard';
            } else {
                location.href = '/client/dashboard';
            }
        } else {
            alert('Xatolik yuz berdi. Qayta urinib ko‘ring');
            btn.textContent = 'Davom etish';
            btn.disabled = false;
        }
    } catch {
        alert('Internet aloqasi yo‘q');
        btn.textContent = 'Davom etish';
        btn.disabled = false;
    }
}
</script>

</body>
</html>