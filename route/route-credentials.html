<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Reys Tafsilotlari</title>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
 --primary-color:#900000;
 --primary-light:#d32f2f;
 --accent-color:#1d4ed8;
 --secondary-color:#1f2937;
 --text-muted:#6b7280;
 --bg-color:#f5f5f5;
 --white:#fff;
 --radius-xl:22px;
 --radius-lg:14px;
 --shadow:0 4px 12px rgba(0,0,0,.08);
}
body,html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg-color);color:var(--secondary-color);height:100%;overflow-x:hidden}
.header{position:sticky;top:0;height:60px;background:var(--primary-color);color:var(--white);display:flex;align-items:center;padding:0 16px;z-index:20;box-shadow:0 2px 5px rgba(0,0,0,.15)}
.back-btn{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:none;background:rgba(255,255,255,.12);backdrop-filter:blur(8px);cursor:pointer}
.back-btn svg{fill:var(--white);width:22px;height:22px}
.header h1{font-size:18px;font-weight:700;margin-left:12px}
.main{padding:14px;max-width:620px;margin:0 auto;display:flex;flex-direction:column;gap:14px}
.loader{text-align:center;padding:120px 20px;font-size:18px;color:var(--text-muted)}

.route-hero{background:var(--white);padding:20px;border-radius:var(--radius-xl);box-shadow:var(--shadow);display:flex;flex-direction:column;gap:16px;position:relative}
.hero-top{display:flex;justify-content:space-between;align-items:center}
.city-block{text-align:center;flex:1}
.city-name{font-size:22px;font-weight:800;color:var(--primary-color)}
.city-label{font-size:11px;text-transform:uppercase;color:var(--text-muted);margin-top:4px;font-weight:600}
.hero-center{display:flex;justify-content:center;align-items:center;position:relative}
.hero-center svg{width:28px;height:28px;fill:var(--text-muted);opacity:.7}
.line{position:absolute;top:50%;left:0;right:0;height:2px;background:#e5e7eb;z-index:-1}
.status-badge{text-align:center;font-size:11px;font-weight:800;padding:6px 14px;border-radius:20px;margin-top:6px;text-transform:uppercase;width:max-content;margin-left:auto;margin-right:auto}
.status-badge.active{background:#d1fae5;color:#065f46}
.status-badge.finished{background:#e5e7eb;color:#4b5563}

.card{background:var(--white);border-radius:var(--radius-xl);padding:18px 18px 12px;box-shadow:var(--shadow)}
.card-title{font-size:15px;font-weight:800;color:var(--secondary-color);border-left:4px solid var(--primary-color);padding-left:10px;margin-bottom:14px}
.list{display:flex;flex-direction:column}
.item{padding:12px 0;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #f0f0f0}
.item:last-child{border-bottom:none}
.label{font-size:14px;color:var(--text-muted);font-weight:600;display:flex;align-items:center}
.label svg{width:18px;height:18px;fill:var(--accent-color);opacity:.8;margin-right:8px}
.value{font-size:15px;font-weight:700;color:var(--secondary-color);text-align:right}

.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px;padding-top:6px}
.gallery img{width:100%;height:90px;object-fit:cover;border-radius:var(--radius-lg);box-shadow:0 2px 8px rgba(0,0,0,.08)}

.action-bar{position:fixed;bottom:0;left:0;right:0;padding:14px 16px;background:var(--white);box-shadow:0 -2px 10px rgba(0,0,0,.12)}
.action-btn{width:100%;padding:15px;background:linear-gradient(90deg,var(--primary-color),var(--primary-light));color:var(--white);border-radius:14px;font-size:16px;font-weight:800;border:none;cursor:pointer;transition:.25s}
.action-btn:active{transform:scale(.98)}
.action-btn:disabled{background:#b4b4b4;color:#eee;cursor:not-allowed}
</style>
</head>
<body>
<header class="header">
 <button class="back-btn" onclick="history.back()"><svg viewBox="0 0 24 24"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg></button>
 <h1>Reys Tafsilotlari</h1>
</header>
<main class="main"><div id="content" class="loader">Yuklanmoqda...</div></main>
<div id="action-bar-container" class="action-bar" style="display:none"></div>
<script>
(async()=>{
 const token=localStorage.getItem('token');
 const role=localStorage.getItem('role')||'CLIENT';
 const routeId=new URLSearchParams(location.search).get('id');
 const contentEl=document.getElementById('content');
 const action=document.getElementById('action-bar-container');
 if(!routeId)return contentEl.innerHTML='<div class="loader" style="color:var(--primary-light)">Reys ID topilmadi</div>';
 const err=m=>contentEl.innerHTML=`<div class="loader" style="color:var(--primary-light)">${m}</div>`;
 try{
  const res=await fetch(`https://api.rout24.online/routes/${routeId}`,{headers:{Authorization:`Bearer ${token}`}});
  if(!res.ok)throw 0;
  const {success,data}=await res.json();
  if(!success||!data)throw 0;
  const d=new Date(data.departureDate);
  const fDate=d.toLocaleDateString('uz-UZ',{year:'numeric',month:'long',day:'numeric'});
  const fTime=d.toLocaleTimeString('uz-UZ',{hour:'2-digit',minute:'2-digit'});
  const fWeek=d.toLocaleDateString('uz-UZ',{weekday:'long'});
  const price=data.price?data.price.toLocaleString('uz-UZ'):'Noma’lum';

  contentEl.innerHTML=`
   <div class='route-hero'>
     <div class='hero-top'>
       <div class='city-block'><div class='city-name'>${data.from}</div><div class='city-label'>Ketish</div></div>
       <div class='city-block'><div class='city-name'>${data.to}</div><div class='city-label'>Borish</div></div>
     </div>
     <div class='hero-center'>
       <div class='line'></div>
       <svg viewBox='0 0 24 24'><path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z'/></svg>
     </div>
     <div class='status-badge ${data.finished?'finished':'active'}'>${data.finished?'Yakunlangan':'Faol'}</div>
   </div>

   <div class='card'>
     <div class='card-title'>Reys Ma’lumotlari</div>
     <div class='list'>
       <div class='item'><div class='label'><svg viewBox='0 0 24 24'><path d='M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM5 9h14v11H5z'/></svg>Sana</div><div class='value'>${fDate} (${fWeek})</div></div>
       <div class='item'><div class='label'><svg viewBox='0 0 24 24'><path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z'/></svg>Vaqt</div><div class='value'>${fTime}</div></div>
       <div class='item'><div class='label'><svg viewBox='0 0 24 24'><path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z'/></svg>Narx</div><div class='value'>${price} so'm</div></div>
       <div class='item'><div class='label'><svg viewBox='0 0 24 24'><path d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z'/></svg>Bo'sh joy</div><div class='value'>${data.seatsCount} ta</div></div>
     </div>
   </div>

   <div class='card'>
     <div class='card-title'>Manzillar</div>
     <div class='list'>
       <div class='item'><div class='label'><svg viewBox='0 0 24 24'><path d='M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z'/></svg>Ketish</div><div class='value'>${data.fromAddress}</div></div>
       <div class='item'><div class='label'><svg viewBox='0 0 24 24'><path d='M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z'/></svg>Borish</div><div class='value'>${data.toAddress}</div></div>
     </div>
   </div>

   <div class='card'>
     <div class='card-title'>Haydovchi</div>
     <div class='list'>
       <div class='item'><div class='label'><svg viewBox='0 0 24 24'><path d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z'/></svg>F.I.Sh.</div><div class='value'>${data.driverFullName||'Ma’lumot yo‘q'}</div></div>
       <div class='item'><div class='label'><svg viewBox='0 0 24 24'><path d='M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8z'/></svg>Transport</div><div class='value'>${data.vehicleName||'Noma’lum'}</div></div>
     </div>
     ${data.driverContact?`<a href="https://t.me/${data.driverContact}" target="_blank" style="margin-top:12px;display:flex;align-items:center;gap:8px;background:#0088cc;color:#fff;padding:10px 16px;border-radius:20px;font-weight:700;font-size:13px;width:max-content"><svg viewBox='0 0 24 24' width='16' height='16'><path fill='currentColor' d='M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.18-1.27l17.6-6.79c1.04-.4 1.95.24 1.59 1.27l-3 17.49c-.23.99-1.07 1.24-1.92.77l-4.64-3.42-2.23 2.15c-.25.25-.46.46-.94.46z'/></svg>Telegram</a>`:''}
   </div>

   ${data.vehicleImages?.length?`
   <div class='card'>
     <div class='card-title'>Rasmlar</div>
     <div class='gallery'>${data.vehicleImages.map(i=>`<img src='${i}'/>`).join('')}</div>
   </div>`:''}
  `;

  const isDriver=role==='DRIVER';
  const disabled=isDriver||data.finished;
  action.innerHTML=`<button class='action-btn' id='book' ${disabled?'disabled':''}>${data.finished?'Yakunlangan':isDriver?'Mavjud emas':'Chipta bron qilish'}</button>`;
  action.style.display='block';
  if(!disabled)document.getElementById('book').onclick=()=>location.href=`order.html?id=${routeId}`;
 }catch(e){err('Ma’lumot yuklanmadi')}
})();
</script>
</body>
</html>