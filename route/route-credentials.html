<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reys ma'lumotlari</title>
    <style>
        /* CSS USLUBLARI ASOSAN SAQLANGAN VA BIR NECHTA DETAL O'ZGARTIRILGAN */
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        body,html{height:100%;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;color:#0f172a;background:#f8fafc;overflow-x:hidden}
        .header{position:fixed;top:0;left:0;right:0;height:74px;background:#800000;color:#fff;display:flex;align-items:center;padding:0 20px;box-shadow:0 8px 30px rgba(128,0,0,.18);z-index:1000}
        .back-btn{background:none;border:none;width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s}
        .back-btn:active{transform:scale(.92);background:rgba(255,255,255,.12)}
        .back-btn svg{width:28px;height:28px;fill:#fff}
        .header h1{font-size:23px;font-weight:900;margin-left:0 10px 0 12px}
        .main{padding:90px 20px 140px}

        /* HERO BLOK USLUBINI YAXSHILASH */
        .route-hero{
            background:linear-gradient(135deg,#800000,#c62828);
            color:#fff;
            padding:50px 28px; /* Padding kattalashtirildi */
            border-radius:32px;
            text-align:center;
            max-width:640px;
            margin:0 auto 40px;
            box-shadow:0 30px 80px rgba(128,0,0,.35);
            position:relative;
            overflow:hidden;
            display: flex; /* Yangi: flex konteyner */
            flex-direction: column;
            align-items: center;
        }
        .route-hero::after{content:'';position:absolute;inset:0;background:linear-gradient(transparent 40%,rgba(0,0,0,.4))}
        .route-from{font-size:28px;font-weight:700;opacity:.95}
        .route-arrow{
            /* Down Arrow o'rniga ancha chiroyli strelka */
            display: block;
            margin: 10px 0;
            width: 50px;
            height: 50px;
        }
        .route-arrow svg {
            width: 100%;
            height: 100%;
            fill: #fff;
            opacity: 0.8;
        }
        .route-to{font-size:42px;font-weight:900}

        .info-section{background:#fff;border-radius:28px;padding:32px 28px;margin-bottom:28px;box-shadow:0 15px 45px rgba(0,0,0,.08)}
        .section-title{font-size:21px;font-weight:800;color:#800000;margin-bottom:24px;position:relative}
        .section-title::after{content:'';position:absolute;left:0;bottom:-8px;width:60px;height:5px;background:#800000;border-radius:3px}
        
        .info-grid{display:grid;gap:24px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
        .info-item{display:flex;align-items:flex-start;gap:18px}
        .info-item svg{width:32px;height:32px;fill:#800000;flex-shrink:0}
        .info-content h4{font-size:15px;font-weight:600;color:#64748b;margin-bottom:4px}
        .info-content p{font-size:19px;font-weight:700;color:#0f172a}
        
        .status-badge{display:inline-block;padding:12px 28px;border-radius:40px;font-weight:800;font-size:15px;margin-top:20px}
        .status-badge.active{background:#dcfce7;color:#166534}
        .status-badge.finished{background:#f8fafc;color:#475569;border:2px solid #e2e8f0}
        
        .telegram-btn{display:inline-flex;align-items:center;gap:12px;background:#0088cc;color:#fff;padding:14px 24px;border-radius:40px;font-weight:700;font-size:16px;text-decoration:none;box-shadow:0 8px 25px rgba(0,136,204,.3);transition:.3s;margin-top:20px;}
        .telegram-btn:hover{background:#006ba1;transform:translateY(-2px)}
        
        .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px;margin-top:20px}
        .gallery img{width:100%;height:170px;object-fit:cover;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.15)}
        
        .action-btn{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);width:90%;max-width:520px;padding:20px;background:linear-gradient(135deg,#800000,#c62828);color:#fff;border:none;border-radius:28px;font-size:20px;font-weight:900;letter-spacing:0.5px;box-shadow:0 20px 50px rgba(128,0,0,.4);cursor:pointer;z-index:999;transition:.4s}
        .action-btn:hover{transform:translateX(-50%) translateY(-8px);box-shadow:0 25px 60px rgba(128,0,0,.5)}
        .action-btn:active{transform:translateX(-50%) scale(.96)}
        .loader{text-align:center;padding:140px 20px;font-size:19px;color:#94a3b8}

        /* Qo'shimcha CSS: Manzillar orasidagi separatorni chizish */
        .address-separator {
            width: 2px;
            height: 20px;
            background: #800000;
            margin: 10px 0 10px 15px;
            opacity: 0.4;
        }

        @media (max-width:480px){
            .main{padding:90px 16px 140px}
            .route-hero{padding:40px 20px;margin:0 10px 36px}
            .route-to{font-size:36px}
            .info-section{padding:28px 20px}
            .gallery{grid-template-columns:1fr 1fr}
        }
    </style>
</head>
<body>

<header class="header">
    <button class="back-btn" onclick="history.back()">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <h1>Reys ma'lumotlari</h1>
</header>

<main class="main">
    <div id="content" class="loader">Yuklanmoqda...</div>
</main>

<script>
const token = localStorage.getItem('token');
const role = localStorage.getItem('role') || '';
if (!token) location.href = '/login';

const routeId = new URLSearchParams(location.search).get('id');
if (!routeId) {
    document.getElementById('content').innerHTML = '<div class="loader" style="color:#c62828">Reys topilmadi</div>';
}

(async () => {
    try {
        const res = await fetch(`https://api.rout24.online/routes/${routeId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        if (!res.ok) throw new Error();
        const { success, data } = await res.json();
        if (!success || !data) throw new Error();

        const date = new Date(data.departureDate);
        const fDate = date.toLocaleDateString('uz-UZ', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
        const fTime = date.toLocaleTimeString('uz-UZ', { hour:'2-digit', minute:'2-digit' });

        const bookBtn = role === 'CLIENT'
            ? `<button class="action-btn" onclick="location.href='order.html?id=${routeId}'">Bron qilish</button>`
            : '';

        document.getElementById('content').innerHTML = `
            <div class="route-hero">
                <div class="route-from">${data.from}</div>
                <div class="route-arrow">
                    <svg viewBox="0 0 24 24"><path d="M6 12l-1.41 1.41L4.18 12 6 13.82 17.82 2h2.83l-3 3H20c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4L2 4v16l2 2h16c1.1 0 2-.9 2-2v-3.59l1.41-1.41L20 12h-2zm-2 0h14v2H4z"/></svg>
                </div>
                <div class="route-to">${data.to}</div>
            </div>
            
            <div class="info-section" style="text-align:center;">
                <div class="section-title">Reys statusi</div>
                <div class="status-badge ${data.finished?'finished':'active'}">${data.finished?'Yakunlangan':'Faol'}</div>
            </div>

            <div class="info-section">
                <div class="section-title">Manzillar</div>
                <div class="info-item">
                    <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                    <div class="info-content"><h4>Ketish manzili</h4><p>${data.fromAddress}</p></div>
                </div>
                <div class="address-separator"></div> 
                <div class="info-item">
                    <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                    <div class="info-content"><h4>Borish manzili</h4><p>${data.toAddress}</p></div>
                </div>
            </div>
            
            <div class="info-section">
                <div class="section-title">Ketish vaqti</div>
                <div class="info-grid">
                    <div class="info-item">
                        <svg viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM7 11h2v2H7v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2z"/></svg>
                        <div class="info-content"><h4>Sana</h4><p>${fDate}</p></div>
                    </div>
                    <div class="info-item">
                        <svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zM12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.62z"/></svg>
                        <div class="info-content"><h4>Vaqt</h4><p>${fTime}</p></div>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <div class="section-title">Narx va joylar</div>
                <div class="info-grid">
                    <div class="info-item">
                        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        <div class="info-content"><h4>Narx</h4><p>${data.price.toLocaleString('uz-UZ')} so'm</p></div>
                    </div>
                    <div class="info-item">
                        <svg viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-4c0 2.21 1.79 4 4 4 2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4zm16 12c0-2.66-5.33-4-8-4-2.67 0-8 1.34-8 4v2h16v-2z"/></svg>
                        <div class="info-content"><h4>Bo'sh o'rinlar</h4><p>${data.seatsCount} ta</p></div>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <div class="section-title">Haydovchi</div>
                <div class="info-item">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    <div class="info-content">
                        <h4>Ism familiyasi</h4>
                        <p>${data.driverFullName ? data.driverFullName : "Ma'lumot kiritilmagan"}</p>
                    </div>
                </div>
                ${data.driverContact ? `
                <a href="https://t.me/${data.driverContact}" target="_blank" class="telegram-btn">
                    <svg viewBox="0 0 24 24" style="width:24px;height:24px;fill:currentColor"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.18-1.27l17.6-6.79c1.04-.4 1.95.24 1.59 1.27l-3 17.49c-.23.99-1.07 1.24-1.92.77l-4.64-3.42-2.23 2.15c-.25.25-.46.46-.94.46z"/></svg>
                    t.me/${data.driverContact}
                </a>` : ''}
            </div>

            ${data.vehicleName ? `
            <div class="info-section">
                <div class="section-title">Transport vositasi</div>
                <div class="info-item">
                    <svg viewBox="0 0 24 24"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 17c-.83 0-1.5-.67-1.5-1.5S5.67 14 6.5 14s1.5.67 1.5 1.5S7.33 17 6.5 17zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 12l1.5-4.5h11L19 12H5z"/></svg>
                    <div class="info-content"><h4>Mashina modeli</h4><p>${data.vehicleName}</p></div>
                </div>
                ${data.vehicleImages?.length ? `
                <div class="gallery">
                    ${data.vehicleImages.map(src=>`<img src="${src}" alt="Mashina" loading="lazy">`).join('')}
                </div>` : ''}
            </div>` : ''}

            ${bookBtn}
        `;
    } catch {
        document.getElementById('content').innerHTML = '<div class="loader" style="color:#c62828">Xatolik yuz berdi</div>';
    }
})();
</script>
</body>
</html>