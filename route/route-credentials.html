<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reys ma'lumotlari</title>
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        body,html{height:100%;background:#fff;color:#800000;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
        .header{position:fixed;top:0;left:0;right:0;height:74px;padding:0 20px;display:flex;align-items:center;background:#fff;z-index:100;box-shadow:0 4px 25px rgba(128,0,0,0.1)}
        .back-btn{background:none;border:none;width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .3s}
        .back-btn:active{transform:scale(.92);background:rgba(128,0,0,0.08)}
        .back-btn svg{width:28px;height:28px;fill:#800000}
        h1{font-size:22px;font-weight:900;margin-left:8px}
        .main{padding:90px 20px 40px}

        .card{max-width:420px;margin:0 auto;background:#fff;border-radius:32px;padding:28px;box-shadow:0 20px 50px rgba(128,0,0,0.14);margin-bottom:24px}
        .route-header{background:linear-gradient(135deg,#800000,#a00000);color:#fff;padding:24px;border-radius:28px;margin:-28px -28px 28px;position:relative;overflow:hidden}
        .route-header::after{content:'';position:absolute;inset:0;background:rgba(0,0,0,0.1)}
        .route-title{font-size:24px;font-weight:900}
        .route-subtitle{font-size:16px;opacity:0.9;margin-top:6px}

        .section{margin-bottom:28px}
        .section-title{font-size:18px;font-weight:800;margin-bottom:16px;color:#333}
        .info-row{display:flex;align-items:center;gap:16px;margin-bottom:16px;font-size:16px}
        .info-row svg{width:24px;height:24px;fill:#800000;flex-shrink:0}
        .info-label{font-weight:600;color:#555;margin-bottom:4px;font-size:14px}
        .info-value{font-size:17px}

        .vehicle-gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:16px}
        .vehicle-img{height:100px;border-radius:20px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,0.15)}
        .vehicle-img img{width:100%;height:100%;object-fit:cover}

        .status{padding:8px 20px;border-radius:22px;font-size:14px;font-weight:700;color:#fff;display:inline-block;margin-top:12px}
        .status.active{background:#4caf50}
        .status.finished{background:#999}

        .loader{text-align:center;padding:60px;font-size:18px;color:#999}
    </style>
</head>
<body>

<header class="header">
    <button class="back-btn" onclick="history.back()">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <h1>Reys ma'lumotlari</h1>
</header>

<main class="main">
    <div id="content" class="loader">Yuklanmoqda...</div>
</main>

<script>
const token = localStorage.getItem('token');
if (!token) location.href = '/login';

const urlParams = new URLSearchParams(window.location.search);
const routeId = urlParams.get('id');

if (!routeId) {
    document.getElementById('content').innerHTML = '<p style="text-align:center;color:#e91e63">Reys ID topilmadi</p>';
}

async function loadRoute() {
    try {
        const res = await fetch(`https://api.rout24.online/routes/${routeId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        const { success, data } = await res.json();
        if (!success || !data) throw new Error('Ma‘lumotlar topilmadi');

        const date = new Date(data.departureDate);
        const formattedDate = date.toLocaleDateString('uz-UZ', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        const formattedTime = date.toLocaleTimeString('uz-UZ', { hour: '2-digit', minute: '2-digit' });

        document.getElementById('content').innerHTML = `
            <div class="card">
                <div class="route-header">
                    <div class="route-title">${data.from} → ${data.to}</div>
                    <div class="route-subtitle">${data.fromAddress} → ${data.toAddress}</div>
                </div>

                <div class="section">
                    <div class="section-title">Umumiy ma'lumot</div>
                    <div class="info-row">
                        <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/></svg>
                        <div>
                            <div class="info-label">Ketish vaqti</div>
                            <div class="info-value">${formattedDate}, ${formattedTime}</div>
                        </div>
                    </div>
                    <div class="info-row">
                        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"/></svg>
                        <div>
                            <div class="info-label">Narx</div>
                            <div class="info-value">${data.price.toLocaleString()} so‘m</div>
                        </div>
                    </div>
                    <div class="info-row">
                        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        <div>
                            <div class="info-label">O‘rinlar soni</div>
                            <div class="info-value">${data.seatsCount} ta</div>
                        </div>
                    </div>
                    <div class="status ${data.finished ? 'finished' : 'active'}">
                        ${data.finished ? 'Yakunlangan' : 'Faol'}
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Haydovchi</div>
                    <div class="info-row">
                        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        <div>
                            <div class="info-label">Ism</div>
                            <div class="info-value">${data.driverFullName || 'Noma‘lum'}</div>
                        </div>
                    </div>
                    <div class="info-row">
                        <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                        <div>
                            <div class="info-label">Aloqa</div>
                            <div class="info-value">${data.driverContact || 'Mavjud emas'}</div>
                        </div>
                    </div>
                </div>

                ${data.vehicleName ? `
                <div class="section">
                    <div class="section-title">Mashina</div>
                    <div class="info-row">
                        <svg viewBox="0 0 24 24"><path d="M18 17h2v-1.5c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5V17zm-12 0h2v-1.5c0-.83-.67-1.5-1.5-1.5S5 16.67 5 17.5V17zm12-6h-4V9h-4V5H8v4H4l-2 8v4h4v-2h12v2h4v-4l-2-8z"/></svg>
                        <div>
                            <div class="info-label">Nomi</div>
                            <div class="info-value">${data.vehicleName}</div>
                        </div>
                    </div>
                    ${data.vehicleImages?.length ? `
                    <div class="vehicle-gallery">
                        ${data.vehicleImages.map(img => `
                            <div class="vehicle-img"><img src="${img}" alt="Mashina"></div>
                        `).join('')}
                    </div>` : ''}
                </div>` : ''}
            </div>
        `;
    } catch (err) {
        console.error(err);
        document.getElementById('content').innerHTML = '<p style="text-align:center;color:#e91e63;margin-top:40px">Ma‘lumotlar yuklanmadi</p>';
    }
}

loadRoute();
</script>
</body>
</html>