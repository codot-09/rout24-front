<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reys ma'lumotlari</title>
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        body,html{height:100%;background:#f8f9fa;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;color:#333}
        
        .header{
            position:fixed;top:0;left:0;right:0;height:74px;
            background:#fff;color:#800000;display:flex;align-items:center;
            padding:0 20px;box-shadow:0 4px 25px rgba(128,0,0,0.12);z-index:1000;
        }
        .back-btn{
            background:none;border:none;width:48px;height:48px;border-radius:50%;
            display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s;
        }
        .back-btn:active{transform:scale(.92);background:rgba(128,0,0,0.08)}
        .back-btn svg{width:28px;height:28px;fill:#800000}
        .header h1{font-size:22px;font-weight:900;margin-left:8px}

        .main{padding:90px 20px 100px;min-height:100vh}

        .card {
            max-width: 560px;
            margin: 0 auto;
            background: #fff;
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(128,0,0,0.16);
        }
        .route-header {
            background: linear-gradient(135deg, #800000, #c62828);
            color: #fff;
            padding: 40px 28px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .route-header::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.2);
        }
        .route-title {
            font-size: 28px;
            font-weight: 900;
            position: relative;
            z-index: 2;
        }
        .route-subtitle {
            font-size: 18px;
            opacity: 0.95;
            margin-top: 8px;
            position: relative;
            z-index: 2;
        }


        .content{padding:32px 28px}

        .section{margin-bottom:36px}
        .section-title{
            font-size:19px;font-weight:800;color:#800000;margin-bottom:18px;
            padding-bottom:8px;position:relative;
        }
        .section-title::after{
            content:'';position:absolute;left:0;bottom:0;width:60px;height:4px;background:#800000;border-radius:2px;
        }

        .info-grid{
            display:grid;gap:20px;
            grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
        }
        .info-row{
            display:flex;align-items:flex-start;gap:16px;font-size:17px;
        }
        .info-row svg{width:28px;height:28px;fill:#800000;flex-shrink:0;margin-top:2px}
        .info-label{font-weight:600;color:#555;font-size:15px}
        .info-value{font-weight:500;margin-top:4px}

        .status{
            display:inline-block;padding:block;padding:10px 24px;border-radius:30px;
            font-weight:700;font-size:15px;margin-top:16px;
        }
        .status.active{background:#e8f5e9;color:#2e7d32}
        .status.finished{background:#fafafa;color:#616161;border:1px solid #ddd}

        .telegram-btn{
            display:inline-flex;align-items:center;gap:10px;
            background:#0088cc;color:#fff;padding:12px 20px;border-radius:30px;
            font-weight:600;font-size:15px;text-decoration:none;
            margin-top:12px;transition:.3s;
        }
        .telegram-btn:hover{background:#006ba1}

        .vehicle-gallery{
            display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:16px;margin-top:20px;
        }
        .vehicle-img{
            height:140px;border-radius:20px;overflow:hidden;
            box-shadow:0 8px 25px rgba(0,0,0,0.15);
        }
        .vehicle img{width:100%;height:100%;object-fit:cover;transition:transform .4s}
        .vehicle:hover img{transform:scale(1.1)}

        .book-btn{
            position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
            width:90%;max-width:500px;padding:18px;
            background:#800000;color:#fff;border:none;
            border-radius:20px;font-size:19px;font-weight:800;
            box-shadow:0 10px 30px rgba(128,0,0,0.25);
            cursor:pointer;transition:all .4s;z-index:999;
        }
        .book-btn:hover{transform:translateX(-50%) translateY(-50%) scale(1.03)}
        .book-btn:active{transform:translateX(-50%) scale(0.98)}

        .loader{
            text-align:center;padding:100px 20px;font-size:18px;color:#999;
        }

        @media (max-width:480px){
            .route-header{padding:32px 20px}
            .route-title{font-size:24px}
            .content{padding:28px 20px}
        }
    </style>
</head>
<body>

<header class="header">
    <button class="back-btn" onclick="history.back()">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <h1>Reys ma'lumotlari</h1>
</header>

<main class="main">
    <div id="content" class="loader">Yuklanmoqda...</div>
</main>

<script>
const token = localStorage.getItem('token');
const role  = localStorage.getItem('role');
if (!token) location.href = '/login';

const urlParams = new URLSearchParams(window.location.search);
const routeId = urlParams.get('id');

if (!routeId) {
    document.getElementById('content').innerHTML = '<p style="text-align:center;color:#c62828;margin-top:80px;font-size:18px">Reys topilmadi</p>';
}

async function loadRoute() {
    try {
        const res = await fetch(`https://api.rout24.online/routes/${routeId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        if (!res.ok) throw new Error('Server xatosi');
        const { success, data } = await res.json();
        if (!success || !data) throw new Error('Ma‘lumotlar topilmadi');

        const date = new Date(data.departureDate);
        const formattedDate = date.toLocaleDateString('uz-UZ', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        const formattedTime = date.toLocaleTimeString('uz-UZ', { hour: '2-digit', minute: '2-digit' });

        let bookButton = '';
        if (role === 'CLIENT') {
            bookButton = `<button class="book-btn" onclick="location.href='order.html?id=${routeId}'">Bron qilish</button>`;
        }

        document.getElementById('content').innerHTML = `
            <div class="card">
                <div class="route-header">
                    <div class="route-title">${data.from} → ${data.to}</div>
                    <div class="route-subtitle">${data.fromAddress} → ${data.toAddress}</div>
                </div>

                <div class="content">

                    <div class="section">
                        <div class="section-title">Ketish vaqti</div>
                        <div class="info-row">
                            <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/></svg>
                            <div>
                                <div class="info-label">Sana va vaqt</div>
                                <div class="info-value">${formattedDate}<br><strong>${formattedTime}</strong></div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">Narx va o‘rinlar</div>
                        <div class="info-grid">
                            <div class="info-row">
                                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"/></svg>
                                <div>
                                    <div class="info-label">Narx</div>
                                    <div class="info-value">${data.price.toLocaleString('uz-UZ')} so‘m</div>
                                </div>
                            </div>
                            <div class="info-row">
                                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                                <div>
                                    <div class="info-label">Bo‘sh o‘rinlar</div>
                                    <div class="info-value">${data.seatsCount} ta</div>
                                </div>
                            </div>
                        </div>
                        <div class="status ${data.finished ? 'finished' : 'active'}">
                            ${data.finished ? 'Yakunlangan' : 'Faol'}
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">Haydovchi</div>
                        <div class="info-grid">
                            <div class="info-row">
                                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                                <div>
                                    <div class="info-label">Ism familiyasi</div>
                                    <div class="info-value">${data.driverFullName || 'Ma’lumot kiritilmagan'}</div>
                                </div>
                            </div>
                        </div>
                        ${data.driverContact ? `
                        <a href="https://t.me/${data.driverContact}" target="_blank" class="telegram-btn">
                            <svg viewBox="0 0 24 24" style="width:20px;height:20px;fill:currentColor"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.18-1.27l17.6-6.79c1.04-.4 1.95.24 1.59 1.27l-3 17.49c-.23.99-1.07 1.24-1.92.77l-4.64-3.42-2.23 2.15c-.25.25-.46.46-.94.46z"/></svg>
                            Telegram orqali bog‘lanish
                        </a>` : ''}
                    </div>

                    ${data.vehicleName ? `
                    <div class="section">
                        <div class="section-title">Transport vositasi</div>
                        <div class="info-row">
                            <svg viewBox="0 0 24 24"><path d="M18 17h2v-1.5c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5V17zm-12 0h2v-1.5c0-.83-.67-1.5-1.5-1.5S5 16.67 5 17.5V17zm12-6h-4V9h-4V5H8v4H4l-2 8v4h4v-2h12v2h4v-4l-2-8z"/></svg>
                            <div>
                                <div class="info-label">Mashina</div>
                                <div class="info-value">${data.vehicleName}</div>
                            </div>
                        </div>

                        ${data.vehicleImages && data.vehicleImages.length ? `
                        <div class="vehicle-gallery">
                            ${data.vehicleImages.map(img => `
                                <div class="vehicle"><img src="${img}" alt="Mashina" loading="lazy"></div>
                            `).join('')}
                        </div>` : ''}
                    </div>` : ''}
                </div>
            </div>

            ${bookButton}
        `;
    } catch (err) {
        console.error(err);
        document.getElementById('content').innerHTML = '<p style="text-align:center;color:#c62828;margin-top:80px;font-size:18px">Ma‘lumotlar yuklanmadi<br><small>Internetni tekshiring</small></p>';
    }
}

loadRoute();
</script>
</body>
</html>