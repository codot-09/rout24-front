<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reys ma'lumotlari</title>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
body,html{height:100%;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f5f5f5;color:#333}
.header{position:fixed;top:0;left:0;right:0;height:70px;padding:0 16px;display:flex;align-items:center;background:#fff;z-index:100;box-shadow:0 4px 10px rgba(0,0,0,0.08)}
.back-btn{background:none;border:none;width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}
.back-btn:active{transform:scale(.95)}
.back-btn svg{width:26px;height:26px;fill:#800000}
h1{font-size:20px;font-weight:700;margin-left:8px;color:#800000}
.main{padding:90px 16px 30px;min-height:100vh;display:flex;flex-direction:column;gap:16px}

/* From→To Cart */
.route-cart{background:linear-gradient(135deg,#800000,#b71c1c);color:#fff;border-radius:16px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,0.12);text-align:center}
.route-cart h2{font-size:18px;font-weight:700;margin-bottom:6px}
.route-cart p{font-size:14px;opacity:0.9}

/* Sections & Tables */
.section{background:#fff;border-radius:16px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,0.08)}
.section-title{font-weight:700;color:#800000;font-size:16px;margin-bottom:12px;border-bottom:2px solid #800000;padding-bottom:4px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:12px 8px;text-align:left;font-size:14px;border-bottom:1px solid #eee}
.table th{font-weight:700;color:#555}
.table td{font-weight:500;color:#333}

/* Status */
.status{display:inline-block;padding:6px 16px;border-radius:20px;font-weight:700;font-size:13px}
.status.active{background:#e8f5e9;color:#2e7d32}
.status.finished{background:#fafafa;color:#616161;border:1px solid #ddd}

/* Telegram Button */
.telegram-btn{display:inline-flex;align-items:center;gap:8px;background:#0088cc;color:#fff;padding:8px 14px;border-radius:20px;font-weight:600;font-size:14px;text-decoration:none;transition:all .3s}
.telegram-btn:hover{background:#006699}

/* Vehicle gallery */
.vehicle-gallery{display:flex;gap:12px;overflow-x:auto;margin-top:12px}
.vehicle-img{flex:0 0 120px;height:120px;border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
.vehicle-img img{width:100%;height:100%;object-fit:cover;transition:transform .3s}
.vehicle-img:hover img{transform:scale(1.1)}

/* Loader */
.loader{text-align:center;padding:60px 10px;font-size:16px;color:#999}

@media (min-width:600px){
    .table th,.table td{font-size:15px}
    .section-title{font-size:18px}
}
</style>
</head>
<body>

<header class="header">
    <button class="back-btn" onclick="history.back()">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <h1>Reys ma'lumotlari</h1>
</header>

<main class="main">
    <div id="content" class="loader">Yuklanmoqda...</div>
</main>

<script>
const token = localStorage.getItem('token');
if(!token) location.href='/login';

const urlParams = new URLSearchParams(window.location.search);
const routeId = urlParams.get('id');

if(!routeId){
    document.getElementById('content').innerHTML='<p style="text-align:center;color:#c62828;margin-top:60px;font-size:16px">Reys ID topilmadi</p>';
}

async function loadRoute(){
    try{
        const res = await fetch(`https://api.rout24.online/routes/${routeId}`,{
            headers:{Authorization:`Bearer ${token}`}
        });
        if(!res.ok) throw new Error('Server xatosi');
        const {success,data} = await res.json();
        if(!success || !data) throw new Error('Ma‘lumotlar topilmadi');

        const date = new Date(data.departureDate);
        const formattedDate = date.toLocaleDateString('uz-UZ',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
        const formattedTime = date.toLocaleTimeString('uz-UZ',{hour:'2-digit',minute:'2-digit'});

        document.getElementById('content').innerHTML=`
        <div class="route-cart">
            <h2>${data.from} → ${data.to}</h2>
            <p>${formattedDate} ${formattedTime}</p>
        </div>

        <div class="section">
            <div class="section-title">Manzillar</div>
            <table class="table">
                <tr><th>From Address</th><td>${data.fromAddress || 'Aniqlanmagan'}</td></tr>
                <tr><th>To Address</th><td>${data.toAddress || 'Aniqlanmagan'}</td></tr>
            </table>
        </div>

        <div class="section">
            <div class="section-title">Umumiy ma'lumot</div>
            <table class="table">
                <tr><th>Narx</th><td>${data.price.toLocaleString('uz-UZ')} so‘m</td></tr>
                <tr><th>Bo‘sh o‘rinlar</th><td>${data.seatsCount} ta</td></tr>
                <tr><th>Status</th><td><span class="status ${data.finished?'finished':'active'}">${data.finished?'Yakunlangan':'Faol'}</span></td></tr>
            </table>
        </div>

        <div class="section">
            <div class="section-title">Haydovchi</div>
            <table class="table">
                <tr><th>Ism familiyasi</th><td>${data.driverFullName || 'Ma’lumot kiritilmagan'}</td></tr>
                <tr><th>Telegram</th>
                    <td><a class="telegram-btn" href="https://t.me/${data.driverContact}" target="_blank">Chatga o'tish</a></td>
                </tr>
            </table>
        </div>

        ${data.vehicleName ? `
        <div class="section">
            <div class="section-title">Transport vositasi</div>
            <table class="table">
                <tr><th>Mashina nomi</th><td>${data.vehicleName}</td></tr>
            </table>
            ${data.vehicleImages && data.vehicleImages.length ? `
            <div class="vehicle-gallery">
                ${data.vehicleImages.map(img=>`<div class="vehicle-img"><img src="${img}" alt="Mashina rasmi" loading="lazy"></div>`).join('')}
            </div>` : ''}
        </div>` : ''}
        `;
    }catch(err){
        console.error(err);
        document.getElementById('content').innerHTML='<p style="text-align:center;color:#c62828;margin-top:60px;font-size:16px">Ma‘lumotlar yuklanmadi. Internetni tekshiring yoki keyinroq urinib ko‘ring.</p>';
    }
}

loadRoute();
</script>
</body>
</html>
