<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reys ma'lumotlari</title>
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        body,html{height:100%;background:linear-gradient(135deg,#f8f9fa,#e9ecef);color:#333;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;overflow-x:hidden}
        
        .header{position:fixed;top:0;left:0;right:0;height:74px;padding:0 20px;display:flex;align-items:center;background:#fff;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
        .back-btn{background:none;border:none;width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .3s}
        .back-btn:active{transform:scale(.92);background:rgba(128,0,0,0.1)}
        .back-btn svg{width:28px;height:28px;fill:#800000}
        h1{font-size:22px;font-weight:900;margin-left:8px;color:#800000}

        .main{padding:90px 20px 40px;min-height:100vh}

        /* Full-width card – container yo‘q */
        .card{
            background:#fff;
            border-radius:24px;
            overflow:hidden;
            box-shadow:0 15px 50px rgba(128,0,0,0.12);
            margin-bottom:32px;
        }

        .route-header{
            background:linear-gradient(135deg,#800000,#b71c1c);
            color:#fff;
            padding:40px 28px;
            text-align:center;
            position:relative;
            overflow:hidden;
        }
        .route-header::after{
            content:'';position:absolute;inset:0;
            background:rgba(0,0,0,0.15);
        }
        .route-title{
            font-size:28px;
            font-weight:900;
            position:relative;
            z-index:2;
        }
        .route-subtitle{
            font-size:18px;
            opacity:0.95;
            margin-top:8px;
            position:relative;
            z-index:2;
        }

        .content{
            padding:32px 28px;
        }

        .section{margin-bottom:36px}
        .section-title{
            font-size:20px;
            font-weight:800;
            margin-bottom:20px;
            color:#800000;
            position:relative;
            padding-bottom:8px;
        }
        .section-title::after{
            content:'';position:absolute;bottom:0;left:0;width:50px;height:4px;background:#800000;border-radius:2px;
        }

        .info-grid{
            display:grid;
            grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));
            gap:20px;
        }
        .info-row{
            display:flex;
            align-items:flex-start;
            gap:16px;
            font-size:17px;
        }
        .info-row svg{
            width:28px;height:28px;fill:#800000;flex-shrink:0;margin-top:2px;
        }
        .info-label{
            font-weight:600;
            color:#555;
            font-size:15px;
        }
        .info-value{
            font-weight:500;
            margin-top:4px;
        }

        .status{
            display:inline-block;
            padding:10px 24px;
            border-radius:30px;
            font-weight:700;
            font-size:15px;
            margin-top:16px;
        }
        .status.active{background:#e8f5e9;color:#2e7d32}
        .status.finished{background:#fafafa;color:#616161;border:1px solid #ddd}

        .vehicle-gallery{
            display:grid;
            grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));
            gap:16px;
            margin-top:20px;
        }
        .vehicle-img{
            height:140px;
            border-radius:20px;
            overflow:hidden;
            box-shadow:0 8px 25px rgba(0,0,0,0.15);
        }
        .vehicle-img img{
            width:100%;height:100%;object-fit:cover;transition:transform .4s;
        }
        .vehicle-img:hover img{transform:scale(1.1)}

        .loader{
            text-align:center;
            padding:80px 20px;
            font-size:20px;
            color:#999;
        }

        @media (max-width: 480px){
            .route-header{padding:32px 20px}
            .route-title{font-size:24px}
            .route-subtitle{font-size:16px}
            .content{padding:28px 20px}
        }
    </style>
</head>
<body>

<header class="header">
    <button class="back-btn" onclick="history.back()">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <h1>Reys ma'lumotlari</h1>
</header>

<main class="main">
    <div id="content" class="loader">Yuklanmoqda...</div>
</main>

<script>
const token = localStorage.getItem('token');
if (!token) location.href = '/login';

const urlParams = new URLSearchParams(window.location.search);
const routeId = urlParams.get('id');

if (!routeId) {
    document.getElementById('content').innerHTML = '<p style="text-align:center;color:#c62828;margin-top:60px">Reys ID topilmadi</p>';
}

async function loadRoute() {
    try {
        const res = await fetch(`https://api.rout24.online/routes/${routeId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        if (!res.ok) throw new Error('Server xatosi');
        const { success, data } = await res.json();
        if (!success || !data) throw new Error('Ma‘lumotlar topilmadi');

        const date = new Date(data.departureDate);
        const formattedDate = date.toLocaleDateString('uz-UZ', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        const formattedTime = date.toLocaleTimeString('uz-UZ', { hour: '2-digit', minute: '2-digit' });

        document.getElementById('content').innerHTML = `
            <div class="card">
                <div class="route-header">
                    <div class="route-title">${data.from} → ${data.to}</div>
                    <div class="route-subtitle">${data.fromAddress} → ${data.toAddress}</div>
                </div>

                <div class="content">

                    <div class="section">
                        <div class="section-title">Umumiy ma'lumot</div>
                        <div class="info-grid">
                            <div class="info-row">
                                <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/></svg>
                                <div>
                                    <div class="info-label">Ketish vaqti</div>
                                    <div class="info-value">${formattedDate}<br><strong>${formattedTime}</strong></div>
                                </div>
                            </div>
                            <div class="info-row">
                                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"/></svg>
                                <div>
                                    <div class="info-label">Narx</div>
                                    <div class="info-value">${data.price.toLocaleString('uz-UZ')} so‘m</div>
                                </div>
                            </div>
                            <div class="info-row">
                                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                                <div>
                                    <div class="info-label">Bo‘sh o‘rinlar</div>
                                    <div class="info-value">${data.seatsCount} ta</div>
                                </div>
                            </div>
                        </div>
                        <div class="status ${data.finished ? 'finished' : 'active'}">
                            ${data.finished ? 'Yakunlangan' : 'Faol'}
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">Haydovchi</div>
                        <div class="info-grid">
                            <div class="info-row">
                                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                                <div>
                                    <div class="info-label">Ism familiyasi</div>
                                    <div class="info-value">${data.driverFullName || 'Ma’lumot kiritilmagan'}</div>
                                </div>
                            </div>
                            <div class="info-row">
                                <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                                <div>
                                    <div class="info-label">Telefon raqami</div>
                                    <div class="info-value">${data.driverContact || 'Mavjud emas'}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    ${data.vehicleName ? `
                    <div class="section">
                        <div class="section-title">Transport vositasi</div>
                        <div class="info-row">
                            <svg viewBox="0 0 24 24"><path d="M18 17h2v-1.5c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5V17zm-12 0h2v-1.5c0-.83-.67-1.5-1.5-1.5S5 16.67 5 17.5V17zm12-6h-4V9h-4V5H8v4H4l-2 8v4h4v-2h12v2h4v-4l-2-8z"/></svg>
                            <div>
                                <div class="info-label">Mashina nomi</div>
                                <div class="info-value">${data.vehicleName}</div>
                            </div>
                        </div>

                        ${data.vehicleImages && data.vehicleImages.length ? `
                        <div class="vehicle-gallery">
                            ${data.vehicleImages.map(img => `
                                <div class="vehicle-img">
                                    <img src="${img}" alt="Mashina rasmi" loading="lazy">
                                </div>
                            `).join('')}
                        </div>` : ''}
                    </div>` : ''}
                </div>
            </div>
        `;
    } catch (err) {
        console.error(err);
        document.getElementById('content').innerHTML = '<p style="text-align:center;color:#c62828;margin-top:60px;font-size:18px">Ma‘lumotlar yuklanmadi. Internetni tekshiring yoki keyinroq urinib ko‘ring.</p>';
    }
}

loadRoute();
</script>
</body>
</html>